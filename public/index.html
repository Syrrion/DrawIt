<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrawIt - Jeu de dessin multijoueur</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Modules -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/game-ui.css">
    <link rel="stylesheet" href="css/tools.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/layers.css">
    <link rel="stylesheet" href="css/modals.css">
</head>
<body>
    <div id="app">
        <div id="toast-container"></div>
        <!-- Login Screen -->
        <div id="login-screen" class="screen">
            <div class="card">
                <h1>DrawIt</h1>
                
                <div class="avatar-section">
                    <h3>Cr√©e ton Avatar</h3>
                    
                    <div class="avatar-tabs">
                        <button id="tab-emoji" class="tab-btn active">Emoji</button>
                        <button id="tab-draw" class="tab-btn">Dessin</button>
                        <button id="tab-upload" class="tab-btn">Image</button>
                    </div>

                    <div id="avatar-preview-container">
                        <div id="avatar-preview" class="avatar">
                            <span id="avatar-emoji">üé®</span>
                        </div>
                        <canvas id="avatar-canvas" width="100" height="100" class="avatar hidden"></canvas>
                    </div>

                    <div id="mode-emoji" class="avatar-mode-content">
                        <div class="controls">
                            <label>Couleur de fond:</label>
                            <input type="color" id="avatar-color" value="#3498db">
                            <label>Emoji:</label>
                            <select id="avatar-emoji-select">
                                <option value="üé®">üé®</option>
                                <option value="üòé">üòé</option>
                                <option value="üê±">üê±</option>
                                <option value="üöÄ">üöÄ</option>
                                <option value="üëª">üëª</option>
                                <option value="ü§ñ">ü§ñ</option>
                                <option value="ü¶Ñ">ü¶Ñ</option>
                                <option value="üçï">üçï</option>
                            </select>
                        </div>
                    </div>

                    <div id="mode-draw" class="avatar-mode-content hidden">
                        <div class="controls">
                            <div class="mini-toolbar">
                                <div class="avatar-tools-row">
                                    <button id="avatar-tool-pen" class="tool-btn small-btn active" title="Crayon">
                                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                                    </button>
                                    <button id="avatar-tool-fill" class="tool-btn small-btn" data-tooltip="Remplir">
                                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="4" y="4" width="16" height="6" rx="1"></rect>
                                            <path d="M18 10v3a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-3"></path>
                                            <path d="M12 15v6"></path>
                                        </svg>
                                    </button>
                                    <button id="avatar-tool-eraser" class="tool-btn small-btn" data-tooltip="Gomme">
                                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M15.5 3.5 L20.5 8.5 L8.5 20.5 L3.5 15.5 Z"></path>
                                            <line x1="11" y1="8" x2="16" y2="13"></line>
                                        </svg>
                                    </button>
                                    <div class="separator"></div>
                                    <div class="color-trigger small" id="avatar-color-trigger">
                                        <div id="avatar-color-preview" style="background-color: #000000;"></div>
                                    </div>
                                    <button id="avatar-clear-btn" class="secondary small-btn" data-tooltip="Effacer">
                                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                    </button>
                                </div>
                                <div class="avatar-sliders">
                                    <div class="slider-row compact">
                                        <label>Taille</label>
                                        <input type="range" id="avatar-size" min="1" max="20" value="3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="mode-upload" class="avatar-mode-content hidden">
                        <div class="controls">
                            <input type="file" id="avatar-upload" accept="image/*">
                            <div id="avatar-image-controls" class="hidden" style="margin-top: 10px;">
                                <div class="slider-row compact">
                                    <label>Zoom</label>
                                    <input type="range" id="avatar-zoom" min="0.1" max="3" step="0.1" value="1">
                                </div>
                                <p style="font-size: 0.8rem; color: var(--text-dim); margin-top: 5px;">Glissez pour d√©placer</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <input type="text" id="username" placeholder="Ton pseudo" maxlength="15">
                </div>

                <div class="room-controls">
                    <div class="input-group">
                        <input type="text" id="room-code-input" placeholder="Code de la room">
                        <button id="join-btn">Rejoindre</button>
                    </div>
                    <p>ou</p>
                    <button id="create-btn" class="secondary">Cr√©er une room priv√©e</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen hidden">
            <!-- Top Bar -->
            <div id="game-top-bar" class="game-top-bar hidden">
                <div class="timer-display">
                    <i class="fas fa-clock"></i> <span id="timer-value">0</span>
                </div>
                <div class="word-display" id="word-display">
                    _ _ _ _ _
                </div>
                <div class="round-info">
                    Round <span id="round-current">1</span>/<span id="round-total">3</span>
                </div>
            </div>

            <!-- Word Choice Modal -->
            <div id="word-choice-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>Choisissez un mot</h3>
                    <div class="word-choice-timer">Temps restant : <span id="word-choice-timer-val">20</span>s</div>
                    <div id="word-choices-container" class="word-choices">
                        <!-- Buttons will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Round Result Overlay -->
            <div id="round-result-overlay" class="modal hidden">
                <div class="modal-content result-content">
                    <h2 id="round-result-title">Le mot √©tait :</h2>
                    <div class="result-subtitle">Le mot √©tait :</div>
                    <div id="round-result-word" class="result-word">MAISON</div>
                    <div class="result-subtitle">Points gagn√©s ce tour :</div>
                    <div id="round-result-scores" class="result-scores"></div>
                </div>
            </div>

            <!-- Game End Modal -->
            <div id="game-end-modal" class="modal hidden">
                <div class="modal-content result-content">
                    <h2><i class="fas fa-trophy"></i> Classement Final</h2>
                    <div id="game-end-scores" class="result-scores leaderboard"></div>
                    <div class="modal-actions">
                        <button id="btn-return-lobby" class="btn-primary">Retour au lobby</button>
                    </div>
                </div>
            </div>

            <!-- Ready Check Modal -->
            <div id="ready-check-modal" class="modal hidden">
                <div class="modal-content ready-check-content">
                    <h2><i class="fas fa-check-circle"></i> √ätes-vous pr√™t ?</h2>
                    <div class="ready-status">
                        <div class="ready-count"><span id="ready-count-val">0</span>/<span id="ready-total-val">0</span></div>
                        <div>joueurs pr√™ts</div>
                    </div>
                    <div id="ready-players-list" class="ready-players-list"></div>
                    <button id="btn-i-am-ready" class="btn-ready">JE SUIS PR√äT !</button>
                    <div class="ready-timer">Annulation dans <span id="ready-timer-val">60</span>s</div>
                </div>
            </div>

            <!-- Game Settings Modal -->
            <div id="lobby-settings-modal" class="modal hidden">
                <div class="modal-content settings-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-cog"></i> Param√®tres de la partie</h3>
                        <button id="btn-close-settings" class="close-btn"><i class="fas fa-times"></i></button>
                    </div>
                    
                    <div class="setting-section">
                        <label>Mode de jeu</label>
                        <div class="gamemode-cards">
                            <div class="gamemode-card selected" data-mode="guess-word">
                                <div class="card-icon"><i class="fas fa-pencil-alt"></i></div>
                                <div class="card-info">
                                    <h4>Devine le dessin</h4>
                                    <p>Un joueur dessine, les autres devinent.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="settings-guess-word">
                        <div class="setting-group">
                            <label>Temps de dessin (sec)</label>
                            <input type="number" id="setting-drawtime" value="80" min="30" max="300">
                        </div>
                        <div class="setting-group">
                            <label>Temps de choix (sec)</label>
                            <input type="number" id="setting-wordchoicetime" value="20" min="10" max="60">
                        </div>
                        <div class="setting-group">
                            <label>Choix de mots</label>
                            <input type="number" id="setting-wordchoices" value="3" min="1" max="5">
                        </div>
                        <div class="setting-group">
                            <label>Nombre de tours</label>
                            <input type="number" id="setting-rounds" value="3" min="1" max="10">
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button id="btn-start-game" class="btn-primary">
                            <i class="fas fa-play"></i> Lancer la partie
                        </button>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="room-info">
                    <h3>Room</h3>
                    <div class="room-code-wrapper">
                        <span id="display-room-code" class="code-hidden"></span>
                        <div class="room-actions">
                            <button id="toggle-code-btn" title="Afficher/Masquer">
                                <svg id="icon-eye" viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                <svg id="icon-eye-off" class="hidden" viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
                            </button>
                            <button id="copy-code-btn" title="Copier le code">
                                <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="lobby-controls" class="hidden">
                    <button id="btn-open-settings" class="btn-primary full-width">
                        <i class="fas fa-cog"></i> Commencer une partie
                    </button>
                    <div id="waiting-message" class="waiting-status hidden">
                        <div class="loading-dots">
                            <span></span><span></span><span></span>
                        </div>
                        <span>En attente du leader...</span>
                    </div>
                </div>

                <div id="players-list" class="players-list">
                    <!-- Players will be added here -->
                </div>
                
                <div class="layers-panel">
                    <div class="layers-header">
                        <h3>Calques</h3>
                        <button id="add-layer-btn" title="Nouveau calque">
                            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <div id="layers-list" class="layers-list">
                        <!-- Layers will be added here -->
                    </div>
                </div>
            </div>
            
            <div class="main-area">
                <div class="canvas-container" id="canvas-container">
                    <div class="canvas-wrapper" style="position: relative;">
                        <canvas id="drawing-board"></canvas>
                        <div id="cursors-layer"></div>
                    </div>
                    <div id="zoom-overlay" class="zoom-overlay hidden">100%</div>
                </div>

                <div class="toolbar">
                    <div class="tool-group">
                        <div class="color-picker-wrapper">
                            <label>Couleur</label>
                            <div class="color-trigger" id="color-trigger">
                                <div id="current-color-preview"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tool-group sliders-group">
                        <div class="slider-row">
                            <label>Taille</label>
                            <input type="range" id="pen-size" min="1" max="50" value="5">
                        </div>
                        <div class="slider-row">
                            <label>Opacit√©</label>
                            <input type="range" id="pen-opacity" min="0.1" max="1" step="0.1" value="1">
                        </div>
                    </div>

                    <div class="tool-group">
                        <button id="tool-pen" class="tool-btn active" data-tooltip="Crayon">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                        </button>
                        <button id="tool-airbrush" class="tool-btn" data-tooltip="Spray">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="8" width="12" height="13" rx="2"></rect><path d="M15 8V4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v4"></path><path d="M12 3v1"></path><path d="M10 12h.01"></path><path d="M14 12h.01"></path><path d="M12 15h.01"></path><path d="M10 17h.01"></path><path d="M14 17h.01"></path></svg>
                        </button>
                        <button id="tool-fill" class="tool-btn" data-tooltip="Remplir">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="4" y="4" width="16" height="6" rx="1"></rect>
                                <path d="M18 10v3a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-3"></path>
                                <path d="M12 15v6"></path>
                            </svg>
                        </button>
                        <button id="tool-smudge" class="tool-btn" data-tooltip="Doigt (M√©lange)">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"></path>
                                <path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"></path>
                                <path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path>
                                <path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path>
                            </svg>
                        </button>
                        <button id="tool-eraser" class="tool-btn" data-tooltip="Gomme">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M15.5 3.5 L20.5 8.5 L8.5 20.5 L3.5 15.5 Z"></path>
                                <line x1="11" y1="8" x2="16" y2="13"></line>
                            </svg>
                        </button>
                        <button id="tool-rect" class="tool-btn" data-tooltip="Carr√©">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </button>
                        <button id="tool-circle" class="tool-btn" data-tooltip="Cercle">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle></svg>
                        </button>
                        <button id="tool-triangle" class="tool-btn" data-tooltip="Triangle">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path></svg>
                        </button>
                        <button id="tool-line" class="tool-btn" data-tooltip="Trait">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="19" x2="19" y2="5"></line></svg>
                        </button>
                        <button id="btn-undo" class="tool-btn" data-tooltip="Annuler">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7v6h6"></path><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path></svg>
                        </button>
                    </div>

                    <div class="tool-group">
                        <button id="clear-btn" class="danger-btn" data-tooltip="Tout effacer">
                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="chat-sidebar">
                <div class="chat-header">
                    <h3>Chat</h3>
                </div>
                <div id="chat-messages" class="chat-messages">
                    <!-- Messages will appear here -->
                </div>
                <form id="chat-form" class="chat-form">
                    <input type="text" id="chat-input" placeholder="Ecrire un message" autocomplete="off">
                    <button type="submit" title="Envoyer">
                        <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </form>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmation-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Confirmation</h3>
                <p>Voulez-vous vraiment tout effacer ?</p>
                <div class="modal-actions">
                    <button id="confirm-cancel" class="secondary">Annuler</button>
                    <button id="confirm-ok" class="danger-btn">Tout effacer</button>
                </div>
            </div>
        </div>

        <!-- Kick Confirmation Modal -->
        <div id="kick-confirmation-modal" class="modal hidden">
            <div class="modal-content">
                <h3>Expulsion</h3>
                <p>Voulez-vous vraiment expulser <span id="kick-player-name" style="font-weight:bold; color:var(--primary);"></span> ?</p>
                <div class="modal-actions">
                    <button id="kick-cancel" class="secondary">Annuler</button>
                    <button id="kick-confirm" class="danger-btn">Expulser</button>
                </div>
            </div>
        </div>

        <!-- Alert Modal -->
        <div id="alert-modal" class="modal hidden">
            <div class="modal-content">
                <h3 id="alert-title">Attention</h3>
                <p id="alert-message">Message d'alerte</p>
                <div class="modal-actions">
                    <button id="alert-ok" class="btn-primary">OK</button>
                </div>
            </div>
        </div>

        <div id="color-popover" class="color-popover hidden">
            <div class="color-grid" id="color-grid">
                <!-- Generated by JS -->
            </div>
            <div class="custom-color-picker">
                <div class="cp-saturation-area" id="cp-saturation-area">
                    <div class="cp-saturation-cursor" id="cp-saturation-cursor"></div>
                </div>
                <div class="cp-hue-area" id="cp-hue-area">
                    <div class="cp-hue-cursor" id="cp-hue-cursor"></div>
                </div>
                <div class="cp-controls">
                    <div class="cp-preview-color" id="cp-preview-color"></div>
                    <div class="cp-rgb-inputs">
                        <div class="cp-input-group">
                            <label>R</label>
                            <input type="number" id="cp-r" min="0" max="255" value="0">
                        </div>
                        <div class="cp-input-group">
                            <label>G</label>
                            <input type="number" id="cp-g" min="0" max="255" value="0">
                        </div>
                        <div class="cp-input-group">
                            <label>B</label>
                            <input type="number" id="cp-b" min="0" max="255" value="0">
                        </div>
                    </div>
                </div>
                <input type="hidden" id="pen-color" value="#000000">
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="client.js"></script>
</body>
</html>
